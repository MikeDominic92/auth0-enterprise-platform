# Architecture Overview Diagrams

Enterprise B2B SaaS Authorization Platform - Visual Architecture

## System Architecture

```
+------------------------------------------------------------------+
|                        CLIENT LAYER                               |
+------------------------------------------------------------------+
|                                                                   |
|  +-------------------+  +-------------------+  +---------------+  |
|  |   React Admin     |  |   Mobile Apps     |  |  Third-Party  |  |
|  |     Portal        |  |   (iOS/Android)   |  |     Apps      |  |
|  +--------+----------+  +--------+----------+  +-------+-------+  |
|           |                      |                     |          |
|           +----------------------+---------------------+          |
|                                  |                                |
+----------------------------------+--------------------------------+
                                   |
                                   v
+------------------------------------------------------------------+
|                      AUTH0 LAYER                                  |
+------------------------------------------------------------------+
|                                                                   |
|  +-----------------------------------------------------------+   |
|  |                    Auth0 Universal Login                   |   |
|  |  +------------------+  +----------------+  +------------+  |   |
|  |  | Custom Branding  |  | MFA Enrollment |  | SSO Config |  |   |
|  |  +------------------+  +----------------+  +------------+  |   |
|  +-----------------------------------------------------------+   |
|                                                                   |
|  +-------------------+  +-------------------+  +---------------+  |
|  |  Organizations    |  |     Actions       |  |    RBAC       |  |
|  |  (Multi-tenant)   |  | (Login/Signup/    |  | (Roles &      |  |
|  |                   |  |  Token Flows)     |  |  Permissions) |  |
|  +-------------------+  +-------------------+  +---------------+  |
|                                                                   |
+----------------------------------+--------------------------------+
                                   |
                                   v
+------------------------------------------------------------------+
|                       API GATEWAY                                 |
+------------------------------------------------------------------+
|                                                                   |
|  +-----------------------------------------------------------+   |
|  |                   Express.js Backend                       |   |
|  |                                                            |   |
|  |  +------------------+  +----------------+  +------------+  |   |
|  |  | JWT Validation   |  | Permission     |  | Rate       |  |   |
|  |  | Middleware       |  | Middleware     |  | Limiting   |  |   |
|  |  +------------------+  +----------------+  +------------+  |   |
|  +-----------------------------------------------------------+   |
|                                                                   |
|  API Endpoints:                                                   |
|  +------------+  +------------+  +------------+  +------------+   |
|  | /users     |  | /teams     |  | /audit     |  | /compliance|   |
|  +------------+  +------------+  +------------+  +------------+   |
|                                                                   |
+----------------------------------+--------------------------------+
                                   |
                                   v
+------------------------------------------------------------------+
|                      SERVICE LAYER                                |
+------------------------------------------------------------------+
|                                                                   |
|  +-------------------+  +-------------------+  +---------------+  |
|  |   UserService     |  | ComplianceService |  |  Anomaly      |  |
|  |                   |  |                   |  |  Detection    |  |
|  | - CRUD ops        |  | - Report gen      |  |               |  |
|  | - Role mgmt       |  | - SOC2/HIPAA/GDPR |  | - Risk score  |  |
|  | - Session mgmt    |  | - Evidence collect|  | - Alerts      |  |
|  +-------------------+  +-------------------+  +---------------+  |
|                                                                   |
+----------------------------------+--------------------------------+
                                   |
                                   v
+------------------------------------------------------------------+
|                       DATA LAYER                                  |
+------------------------------------------------------------------+
|                                                                   |
|  +-------------------+  +-------------------+  +---------------+  |
|  |   PostgreSQL      |  |      Redis        |  | Elasticsearch |  |
|  |                   |  |                   |  |   (optional)  |  |
|  | - Organizations   |  | - Session cache   |  |               |  |
|  | - Users           |  | - Token cache     |  | - Audit logs  |  |
|  | - Teams           |  | - Rate limits     |  | - Search      |  |
|  | - Audit logs      |  |                   |  | - Analytics   |  |
|  | - Compliance      |  |                   |  |               |  |
|  +-------------------+  +-------------------+  +---------------+  |
|                                                                   |
+------------------------------------------------------------------+
```

## Authentication Flow

```
+--------+     +--------+     +--------+     +--------+     +--------+
| Client |     | Auth0  |     | Action |     |  API   |     |   DB   |
+---+----+     +---+----+     +---+----+     +---+----+     +---+----+
    |              |              |              |              |
    | 1. Login     |              |              |              |
    |------------->|              |              |              |
    |              |              |              |              |
    |              | 2. Validate  |              |              |
    |              |    creds     |              |              |
    |              |------------->|              |              |
    |              |              |              |              |
    |              |     3. Run post-login       |              |
    |              |        Action               |              |
    |              |<-------------|              |              |
    |              |              |              |              |
    |              |              | 4. Risk      |              |
    |              |              |    assessment|              |
    |              |              |------------->|              |
    |              |              |              | 5. Log       |
    |              |              |              |------------->|
    |              |              |              |              |
    |              |              | 6. Enrich    |              |
    |              |              |    token     |              |
    |              |<-------------|              |              |
    |              |              |              |              |
    | 7. Return    |              |              |              |
    |    tokens    |              |              |              |
    |<-------------|              |              |              |
    |              |              |              |              |
    | 8. API call with JWT        |              |              |
    |---------------------------->|              |              |
    |              |              |              |              |
    |              |              | 9. Validate  |              |
    |              |              |    & check   |              |
    |              |              |    perms     |              |
    |              |              |<-------------|              |
    |              |              |              |              |
    |              |              |              | 10. Query    |
    |              |              |              |------------->|
    |              |              |              |<-------------|
    |              |              |              |              |
    | 11. Response |              |              |              |
    |<----------------------------|              |              |
    |              |              |              |              |
```

## Multi-Tenant Organization Model

```
+------------------------------------------------------------------+
|                    PLATFORM (System Admin)                        |
+------------------------------------------------------------------+
            |                    |                    |
            v                    v                    v
+------------------+  +------------------+  +------------------+
|   Organization   |  |   Organization   |  |   Organization   |
|    (Tenant A)    |  |    (Tenant B)    |  |    (Tenant C)    |
+------------------+  +------------------+  +------------------+
|                  |  |                  |  |                  |
| +--------------+ |  | +--------------+ |  | +--------------+ |
| | Org Admin    | |  | | Org Admin    | |  | | Org Admin    | |
| +--------------+ |  | +--------------+ |  | +--------------+ |
|        |         |  |        |         |  |        |         |
|        v         |  |        v         |  |        v         |
| +--------------+ |  | +--------------+ |  | +--------------+ |
| |    Teams     | |  | |    Teams     | |  | |    Teams     | |
| | +----------+ | |  | | +----------+ | |  | | +----------+ | |
| | | Team A   | | |  | | | Team X   | | |  | | | Team P   | | |
| | +----------+ | |  | | +----------+ | |  | | +----------+ | |
| | | Team B   | | |  | | | Team Y   | | |  | | | Team Q   | | |
| | +----------+ | |  | | +----------+ | |  | | +----------+ | |
| +--------------+ |  | +--------------+ |  | +--------------+ |
|        |         |  |        |         |  |        |         |
|        v         |  |        v         |  |        v         |
| +--------------+ |  | +--------------+ |  | +--------------+ |
| |    Users     | |  | |    Users     | |  | |    Users     | |
| | - Members    | |  | | - Members    | |  | | - Members    | |
| | - Viewers    | |  | | - Viewers    | |  | | - Viewers    | |
| +--------------+ |  | +--------------+ |  | +--------------+ |
+------------------+  +------------------+  +------------------+

Data Isolation: Each organization has completely isolated data
```

## Permission Model (RBAC + ABAC)

```
+------------------------------------------------------------------+
|                     PERMISSION RESOLUTION                         |
+------------------------------------------------------------------+

User Request
     |
     v
+--------------------+
| Extract JWT Claims |
| - org_id           |
| - roles            |
| - teams            |
| - permissions      |
+--------------------+
     |
     v
+--------------------+     +--------------------+
| Check Static RBAC  |---->| Role Definitions   |
| Permissions        |     | - Super Admin      |
+--------------------+     | - Org Admin        |
     |                     | - Member           |
     | (if dynamic)        | - Read Only        |
     v                     +--------------------+
+--------------------+
| Evaluate ABAC      |
| Policies           |
| - Time-based       |
| - Location-based   |
| - Resource-based   |
+--------------------+
     |
     v
+--------------------+
| Team-Level         |
| Permissions        |
| - Team ownership   |
| - Team membership  |
+--------------------+
     |
     v
+--------------------+
| Final Decision     |
| ALLOW / DENY       |
+--------------------+


Permission Hierarchy:

    system:admin (Platform-wide)
         |
         v
    org:admin (Organization-wide)
         |
    +----+----+
    |         |
    v         v
users:*   teams:*  (Domain-specific)
    |         |
    +----+----+
         |
         v
    Resource-level
    (e.g., users:read)
```

## Compliance and Audit Architecture

```
+------------------------------------------------------------------+
|                    AUDIT TRAIL SYSTEM                             |
+------------------------------------------------------------------+

+------------------+     +------------------+     +------------------+
|  User Actions    |     |  System Events   |     |  Auth Events     |
+------------------+     +------------------+     +------------------+
        |                        |                        |
        +------------------------+------------------------+
                                 |
                                 v
+------------------------------------------------------------------+
|                      AUDIT LOG COLLECTOR                          |
|                                                                   |
|  +------------------+  +------------------+  +------------------+ |
|  | Action Parser    |  | Risk Scorer      |  | Enricher         | |
|  +------------------+  +------------------+  +------------------+ |
+------------------------------------------------------------------+
                                 |
                                 v
+------------------------------------------------------------------+
|                       STORAGE LAYER                               |
|                                                                   |
|  +-------------------+          +-------------------+             |
|  |   PostgreSQL      |          |   Elasticsearch   |             |
|  |   (Primary)       |          |   (Search/Analyze)|             |
|  +-------------------+          +-------------------+             |
+------------------------------------------------------------------+
                                 |
                                 v
+------------------------------------------------------------------+
|                   COMPLIANCE ENGINE                               |
|                                                                   |
|  +------------+  +------------+  +------------+  +------------+  |
|  |   SOC 2    |  |   HIPAA    |  |   GDPR     |  |  ISO 27001 |  |
|  |  Controls  |  |  Controls  |  |  Controls  |  |  Controls  |  |
|  +------------+  +------------+  +------------+  +------------+  |
|                                                                   |
|  Control Mapping:                                                 |
|  - Map audit events to control requirements                       |
|  - Auto-collect evidence                                          |
|  - Generate compliance reports                                    |
+------------------------------------------------------------------+
                                 |
                                 v
+------------------------------------------------------------------+
|                    REPORTING OUTPUTS                              |
|                                                                   |
|  +------------------+  +------------------+  +------------------+ |
|  | Dashboard        |  | PDF Reports      |  | Evidence Export  | |
|  | (Real-time)      |  | (On-demand)      |  | (For auditors)   | |
|  +------------------+  +------------------+  +------------------+ |
+------------------------------------------------------------------+
```

## Risk-Based Authentication Flow

```
+------------------------------------------------------------------+
|                  RISK ASSESSMENT ENGINE                           |
+------------------------------------------------------------------+

Login Attempt
     |
     v
+--------------------+
| Collect Signals    |
| - IP Address       |
| - User Agent       |
| - Geolocation      |
| - Time of day      |
| - Device fingerprint|
+--------------------+
     |
     v
+--------------------+
| Risk Factors       |
+--------------------+
|                    |
| +----------------+ |
| | New Device?    |-------> +15 points
| +----------------+ |
|                    |
| +----------------+ |
| | New Location?  |-------> +20 points
| +----------------+ |
|                    |
| +----------------+ |
| | High-risk      |-------> +25 points
| | Country?       | |
| +----------------+ |
|                    |
| +----------------+ |
| | Impossible     |-------> +30 points
| | Travel?        | |
| +----------------+ |
|                    |
| +----------------+ |
| | Unusual Time?  |-------> +10 points
| +----------------+ |
|                    |
| +----------------+ |
| | Failed Attempts|-------> +5 per attempt
| | (last 24h)?    | |
| +----------------+ |
+--------------------+
     |
     v
+--------------------+
| Calculate Score    |
| (0-100)            |
+--------------------+
     |
     +-----+-----+-----+
     |     |     |     |
     v     v     v     v
   0-30  31-50 51-80 81-100
  ALLOW  ALLOW  MFA   BLOCK
         (log) REQUIRED
```

## Data Flow - User Management

```
+------------------------------------------------------------------+
|                    USER MANAGEMENT FLOW                           |
+------------------------------------------------------------------+

Admin Portal                API Backend                Auth0 + DB
     |                           |                          |
     | 1. Create User            |                          |
     |-------------------------->|                          |
     |                           |                          |
     |                           | 2. Validate request      |
     |                           |    Check permissions     |
     |                           |------------------------->|
     |                           |                          |
     |                           | 3. Create in Auth0       |
     |                           |------------------------->|
     |                           |                          | Auth0
     |                           | 4. Store in local DB     |
     |                           |------------------------->|
     |                           |                          | PostgreSQL
     |                           | 5. Assign roles          |
     |                           |------------------------->|
     |                           |                          |
     |                           | 6. Add to teams          |
     |                           |------------------------->|
     |                           |                          |
     |                           | 7. Log audit event       |
     |                           |------------------------->|
     |                           |                          |
     |                           | 8. Send invite email     |
     |                           |------------------------->|
     |                           |                          | Auth0
     | 9. Return success         |                          |
     |<--------------------------|                          |
     |                           |                          |
```

## Deployment Architecture (Production)

```
+------------------------------------------------------------------+
|                    PRODUCTION DEPLOYMENT                          |
+------------------------------------------------------------------+

                        +------------------+
                        |   CloudFlare     |
                        |   (CDN + WAF)    |
                        +--------+---------+
                                 |
                                 v
                        +------------------+
                        |  Load Balancer   |
                        |  (AWS ALB)       |
                        +--------+---------+
                                 |
              +------------------+------------------+
              |                                     |
              v                                     v
     +------------------+                  +------------------+
     |  App Server 1    |                  |  App Server 2    |
     |  (ECS/Fargate)   |                  |  (ECS/Fargate)   |
     +--------+---------+                  +--------+---------+
              |                                     |
              +------------------+------------------+
                                 |
              +------------------+------------------+
              |                  |                  |
              v                  v                  v
     +---------------+  +---------------+  +---------------+
     | RDS PostgreSQL|  |  ElastiCache  |  | Elasticsearch |
     | (Multi-AZ)    |  |  (Redis)      |  | (OpenSearch)  |
     +---------------+  +---------------+  +---------------+


External Services:
+------------------+  +------------------+  +------------------+
|     Auth0        |  |    SendGrid     |  |   DataDog       |
|  (Identity)      |  |    (Email)      |  |  (Monitoring)   |
+------------------+  +------------------+  +------------------+
```

## Security Boundaries

```
+------------------------------------------------------------------+
|                     SECURITY BOUNDARIES                           |
+------------------------------------------------------------------+

Internet (Untrusted)
     |
     | TLS 1.3
     v
+------------------------------------------------------------------+
|  PERIMETER SECURITY                                               |
|  - WAF (OWASP Top 10 protection)                                  |
|  - DDoS protection                                                |
|  - Rate limiting                                                  |
+------------------------------------------------------------------+
     |
     v
+------------------------------------------------------------------+
|  APPLICATION SECURITY                                             |
|  - JWT validation (RS256)                                         |
|  - Permission middleware                                          |
|  - Input validation (Joi)                                         |
|  - XSS protection (Helmet)                                        |
|  - CORS configuration                                             |
+------------------------------------------------------------------+
     |
     v
+------------------------------------------------------------------+
|  DATA SECURITY                                                    |
|  - Encryption at rest (AES-256)                                   |
|  - Encryption in transit (TLS)                                    |
|  - Row-level security (org_id)                                    |
|  - PII masking in logs                                            |
+------------------------------------------------------------------+
     |
     v
+------------------------------------------------------------------+
|  INFRASTRUCTURE SECURITY                                          |
|  - VPC isolation                                                  |
|  - Security groups                                                |
|  - IAM roles (least privilege)                                    |
|  - Secrets Manager                                                |
+------------------------------------------------------------------+
```

---

Document Version: 1.0
Last Updated: 2025
